package {		import flash.display.*;	import flash.events.MouseEvent;	import flash.events.Event;	import flash.events.ProgressEvent;	import flash.net.URLRequest;	import flash.net.navigateToURL;	import flash.external.ExternalInterface;	import flash.system.Security;		public class Peel extends MovieClip {				private var mainMc:MovieClip;		private var peelMc:MovieClip;		private var adMc:MovieClip;		private var maskMc:MovieClip;		private var teaseMc:MovieClip;				private var rewind:Boolean;		private var flag:Boolean;		private var loader:Loader;				public function Peel() {						Security.allowDomain("*"); // http://livedocs.adobe.com/flash/9.0/ActionScriptLangRefV3/flash/system/Security.html#includeExamplesSummary						// Stage:			stage.scaleMode = StageScaleMode.NO_SCALE;			stage.align = StageAlign.TOP_RIGHT;						init();					}				private function init() {						flag = false;						mainMc = main_mc;			peelMc = main_mc.peel_mc;			maskMc = main_mc.mask_mc;			adMc = main_mc.ad_mc;						mainMc.buttonMode = true;						peelMc.addFrameScript(99, function() { peelMc.stop(); });			maskMc.addFrameScript(99, function() { maskMc.stop(); });			adMc.addFrameScript(99, function() { adMc.stop(); });						addEventListener(Event.ENTER_FRAME, onEnter, false, 0, true);						mainMc.addEventListener(MouseEvent.ROLL_OVER, onOver, false, 0, true);			mainMc.addEventListener(MouseEvent.ROLL_OUT, onOut, false, 0, true);			mainMc.addEventListener(MouseEvent.CLICK, onClick, false, 0, true); // http://www.kirupa.com/forum/showthread.php?t=260312					}				private function onEnter(e:Event):void {						if (peelMc.currentFrame == 1) {				flag = false;				rewind = false;				peelMc.play();				maskMc.play();				adMc.play();			} else if (!flag && (peelMc.currentLabel != 'loop')) {				peelMc.gotoAndPlay('loop');				maskMc.gotoAndPlay('loop');				adMc.gotoAndPlay('loop');			} else if (rewind) {				if (adMc.currentFrame <= 100) {					peelMc.prevFrame();					maskMc.prevFrame();				}				adMc.prevFrame();			}					}				private function onOver(e:MouseEvent):void {						trace(e.type);						flag = true;			rewind = false;			peelMc.play();			maskMc.play();			adMc.play();					}				private function onOut(e:MouseEvent):void {						trace(e.type);						flag = true;			rewind = true;					}				private function onClick(e:MouseEvent):void {			getURL(getClickTag());		}				private function getClickTag():String {			var theReturn = ""			for (var key:String in root.loaderInfo.parameters) {				if(key.toLowerCase() == "clicktag") {					theReturn = root.loaderInfo.parameters[key];					break;				}			}			return theReturn;		}				private function getURL(url:String, window:String = "_blank"):void {			var broswer:String = ExternalInterface.call("function getBrowser(){return navigator.userAgent}") as String;			if(broswer.indexOf("Firefox") != -1 || broswer.indexOf("MSIE 7.0") != -1) {				ExternalInterface.call('window.open("' + url + '","' + window + '")');			} else {				navigateToURL(new URLRequest(url), window);			}		}			}	}